<!DOCTYPE html>
<html lang="ja">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>éƒ¨å±‹å‰²è¡¨ - ãƒ‘ã‚¹ãƒ¯ãƒ¼ãƒ‰èªè¨¼</title>
    <link rel="stylesheet" href="style.css" />
    <style>
      body {
        display: flex;
        align-items: center;
        justify-content: center;
        min-height: 100vh;
      }

      .section {
        max-width: 500px;
        width: 100%;
        margin: 0 auto;
        padding: 20px;
      }

      .description {
        text-align: center;
        color: #2c3e50;
        font-size: 1.1rem;
        line-height: 1.8;
        margin-bottom: 2em;
      }

      #passwordInput {
        width: 100%;
        padding: 1em;
        font-size: 1.1rem;
        border: 2px solid #e0e0e0;
        border-radius: 10px;
        transition: border-color 0.3s ease;
        font-family: "Noto Serif JP", serif;
        text-align: center;
        box-sizing: border-box;
      }

      #passwordInput:focus {
        outline: none;
        border-color: var(--primary);
      }

      .btn-primary {
        width: 100%;
        padding: 1.2em;
        font-size: 1.1rem;
        font-weight: 600;
        background: linear-gradient(135deg, var(--primary) 0%, var(--secondary) 100%);
        color: white;
        border: none;
        border-radius: 10px;
        cursor: pointer;
        transition: all 0.3s ease;
        font-family: "Noto Serif JP", serif;
        margin-top: 15px;
      }

      .btn-primary:hover {
        transform: translateY(-2px);
        box-shadow: 0 8px 20px rgba(74, 144, 226, 0.5);
      }

      .back-link {
        text-align: center;
        margin-top: 20px;
      }

      .back-link a {
        color: var(--primary);
        text-decoration: none;
        font-weight: 600;
      }

      .back-link a:hover {
        opacity: 0.7;
      }
    </style>
  </head>

  <body>
    <section id="room-auth" class="section fade-in">
      <h2 class="section-title">ğŸ” éƒ¨å±‹å‰²è¡¨ã®ç¢ºèª</h2>
      <p class="description">
        ã“ã¡ã‚‰ã®ãƒšãƒ¼ã‚¸ã§ã¯ã€ç ”ä¿®æ—…è¡Œã®<strong>éƒ¨å±‹å‰²è¡¨</strong>ã‚’ç¢ºèªã§ãã¾ã™ã€‚<br />
        é–²è¦§ã«ã¯ãƒ‘ã‚¹ãƒ¯ãƒ¼ãƒ‰ãŒå¿…è¦ã§ã™ã€‚
      </p>

      <div class="card" style="max-width: 380px; margin: 20px auto; padding: 25px">
        <input
          type="password"
          id="passwordInput"
          placeholder="ãƒ‘ã‚¹ãƒ¯ãƒ¼ãƒ‰ã‚’å…¥åŠ›"
          required
        />
        <button onclick="checkPassword()" class="btn-primary">
          è¡¨ç¤ºã™ã‚‹
        </button>
      </div>

      <p class="back-link">
        â† <a href="index.html">ãƒˆãƒƒãƒ—ã¸æˆ»ã‚‹</a>
      </p>
    </section>

    <script>
      // ãƒ•ã‚§ãƒ¼ãƒ‰ã‚¤ãƒ³ã‚¢ãƒ‹ãƒ¡ãƒ¼ã‚·ãƒ§ãƒ³
      const fadeElems = document.querySelectorAll(".fade-in");
      const observer = new IntersectionObserver(
        (entries) => {
          entries.forEach((entry) => {
            if (entry.isIntersecting) {
              entry.target.classList.add("visible");
            }
          });
        },
        { threshold: 0.1 }
      );

      fadeElems.forEach((el) => observer.observe(el));

      // ãƒ‘ã‚¹ãƒ¯ãƒ¼ãƒ‰ãƒã‚§ãƒƒã‚¯æ©Ÿèƒ½ï¼ˆGASèªè¨¼ç‰ˆï¼‰
      function checkPassword() {
        const input = document.getElementById("passwordInput").value;
        const btn = document.querySelector(".btn-primary");

        // å…¥åŠ›ãƒã‚§ãƒƒã‚¯
        if (!input.trim()) {
          alert("ãƒ‘ã‚¹ãƒ¯ãƒ¼ãƒ‰ã‚’å…¥åŠ›ã—ã¦ãã ã•ã„");
          return;
        }

        // ãƒœã‚¿ãƒ³ã‚’ç„¡åŠ¹åŒ–ã—ã¦äºŒé‡é€ä¿¡ã‚’é˜²æ­¢
        btn.textContent = "ç¢ºèªä¸­...";
        btn.disabled = true;

        // Pythonã«å•ã„åˆã‚ã›
        fetch("https://passhash-auth.onrender.com/verify", {
  method: "POST",
  headers: {
    "Content-Type": "application/json",
  },
  body: JSON.stringify({ password: input }),
})
.then((res) => res.json())
.then((data) => {
  if (data.result === "success") {
    btn.textContent = "èªè¨¼æˆåŠŸï¼";
    setTimeout(() => {
      window.location.href = "room.html";
    }, 500);
  } else {
    alert("ãƒ‘ã‚¹ãƒ¯ãƒ¼ãƒ‰ãŒé•ã„ã¾ã™");
    document.getElementById("passwordInput").value = "";
    document.getElementById("passwordInput").focus();
    btn.textContent = "è¡¨ç¤ºã™ã‚‹";
    btn.disabled = false;
  }
})
.catch((err) => {
  console.error("é€šä¿¡ã‚¨ãƒ©ãƒ¼:", err);
  alert("é€šä¿¡ã«å¤±æ•—ã—ã¾ã—ãŸã€‚ã‚‚ã†ä¸€åº¦ãŠè©¦ã—ãã ã•ã„ã€‚");
  btn.textContent = "è¡¨ç¤ºã™ã‚‹";
  btn.disabled = false;
});

}
      // Enterã‚­ãƒ¼ã§ã‚‚é€ä¿¡ã§ãã‚‹ã‚ˆã†ã«ã™ã‚‹
      document.getElementById("passwordInput").addEventListener("keypress", function(e) {
        if (e.key === "Enter") {
          checkPassword();
        }
      });
    </script>
  </body>
</html>
